# Place all the behaviors and hooks related to the matching controller here.
# All this logic will automatically be available in application.js.
# You can use CoffeeScript in this file: http://coffeescript.org/

#Current state number
curState = 0

###Set Timeline width to Scroll Width
setScrollWidth = ->
    timelineWidth = document.getElementById('timeline_container').scrollWidth
    #document.getElementById('kw_container').style.width = timelineWidth + 'px'
    return
###

###Display scrollWidth to HTML element
getScrollWidth = ->
  timelineWidth = document.getElementById('timeline_container').scrollWidth
  document.getElementById('timeline_width').innerHTML = timelineWidth
  return
###

###
window.onload = ->
  #getScrollWidth()
  setScrollWidth()
  return
###
###
$(window).load ->
  i = 1
  while i < 50
    $('<img />').attr 'src', 'assets/us_' + curState + '.gif'
    i++
  return
###
#Set horizontal scrollbar to end
$(window).resize ->
  $('.timeline_section').scrollLeft document.getElementById('timeline_container').scrollWidth
  return

#Display next state in timeline
$(document).ready ->
  $('#nextUSstate').click ->
    if curState < 50
      nextStateSlide()
    return
  return

#Go to previous state in timeline and remove current displayed state
$(document).ready ->
  $('#prevUSstate').click ->
    if curState > 0
       prevStateSlide()
    return
  return

#Changes map image, current state number and changes classes on state
nextStateSlide = ->
  first = $('.tb_state.not-visible').first()
  first.removeClass ' not-visible '
  first.addClass ' visible '
  first.toggle()
  curState++
  $('.timeline_section').animate { scrollLeft: '+=230' }, 100
  $('.map_image').attr 'src', 'assets/us_' + curState + '.gif'
  return

#Changes map image, current state number and changes classes on state
prevStateSlide = ->
  last = $('.tb_state.visible').last()
  last.removeClass ' visible '
  last.addClass ' not-visible '
  last.toggle()
  curState--
  #$('.timeline_section').animate { scrollLeft: '-=230' }, 100
  $('.map_image').attr 'src', 'assets/us_' + curState + '.gif'
  return

#Variable for stopping interval
intervalHolder = undefined

#Goes through state timeline without user input
$(document).ready ->
  $('#playUSstate').click ->
    intervalHolder = setInterval(nextStateSlide, 1000)
    return
  return
#Stops autoplay of state timeline
$(document).ready ->
  $('#stopUSstate').click ->
    clearInterval intervalHolder
    return
  return

#Adds or removes states from timeline section
QuickState = (callback, repetitions) ->
  x = 0
  intervalID = window.setInterval((->
    callback()
    if ++x == repetitions
      window.clearInterval intervalID
    return
  ), 100)
  return

#Jump to the selected state when user selects state name from dropdown list
$(document).ready ->
  $('#ddl_states_name').change ->
    if $('#ddl_states_name').val() > curState
      nextDistance = $('#ddl_states_name').val() - curState
      QuickState nextStateSlide, nextDistance
    else
      prevDistance = curState - $('#ddl_states_name').val()
      QuickState prevStateSlide, prevDistance
    return
  return
  #Jump to the selected state when user selects number from dropdown list
$(document).ready ->
  $('#ddl_states_num').change ->
    if $('#ddl_states_num').val() > curState
      nextDistance = $('#ddl_states_num').val() - curState
      QuickState nextStateSlide, nextDistance
    else
      prevDistance = curState - $('#ddl_states_num').val()
      QuickState prevStateSlide, prevDistance
    return
  return


###
$(document).ready ->
  $('#playUSstate').click ->
    mapSlideshow = undefined

    mapSlideshow = ->
      first = undefined
      if curPlay = false
        return false
      first = $('.tb_state.not-visible').first()
      first.removeClass ' not-visible '
      first.addClass ' visible '
      first.toggle()
      if curState < 50
        $('.timeline_section').animate { scrollLeft: '+=230' }, 2000, ->
          console.log 'Curstate: ' + curState
          curState++
          $('.map_image').attr 'src', 'assets/us_' + curState + '.gif'
          mapSlideshow()
          return
      return

    mapSlideshow()
    return
  return

$(document).ready ->
  $('#stopUSstate').click ->
    curPlay = false
    return
  return
###
